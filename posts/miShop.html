<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="微信小程序：仿小米商城"><meta name="keywords" content="javascript,微信小程序"><meta name="author" content="朵雾"><meta name="copyright" content="朵雾"><title>微信小程序：仿小米商城 | 朵雾のBlog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitment/style/default.min.css"><script src="https://cdn.jsdelivr.net/npm/gitment/dist/gitment.browser.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"BGZ9Z9AK4Y","apiKey":"4467ff422a10815a69d7c2f4a4befe58","indexName":"lin","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '4.2.1'
} </script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="朵雾のBlog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开发准备"><span class="toc-number">1.1.</span> <span class="toc-text">开发准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目目录结构"><span class="toc-number">1.2.</span> <span class="toc-text">项目目录结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#页面解构"><span class="toc-number">2.</span> <span class="toc-text">页面解构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#商城首页"><span class="toc-number">2.1.</span> <span class="toc-text">商城首页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析"><span class="toc-number">2.1.1.</span> <span class="toc-text">页面解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Navigation"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">Navigation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#功能"><span class="toc-number">2.1.2.</span> <span class="toc-text">功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#商品分类页面"><span class="toc-number">2.2.</span> <span class="toc-text">商品分类页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析-1"><span class="toc-number">2.2.1.</span> <span class="toc-text">页面解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#商品详情页面"><span class="toc-number">2.3.</span> <span class="toc-text">商品详情页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析-2"><span class="toc-number">2.3.1.</span> <span class="toc-text">页面解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#商品类别选择"><span class="toc-number">2.4.</span> <span class="toc-text">商品类别选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析-3"><span class="toc-number">2.4.1.</span> <span class="toc-text">页面解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#地址选择和新增地址页"><span class="toc-number">2.5.</span> <span class="toc-text">地址选择和新增地址页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析-4"><span class="toc-number">2.5.1.</span> <span class="toc-text">页面解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发现页"><span class="toc-number">2.6.</span> <span class="toc-text">发现页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#购物车页面"><span class="toc-number">2.7.</span> <span class="toc-text">购物车页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析-5"><span class="toc-number">2.7.1.</span> <span class="toc-text">页面解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#功能-1"><span class="toc-number">2.7.2.</span> <span class="toc-text">功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#我的页面"><span class="toc-number">2.8.</span> <span class="toc-text">我的页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面解析-6"><span class="toc-number">2.8.1.</span> <span class="toc-text">页面解析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#结语"><span class="toc-number">3.</span> <span class="toc-text">结语</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://storage.360buyimg.com/app-oss-dev/2021/8/28a006b14bf34d7aaef4763c821ace7b.jpeg"></div><div class="author-info__name text-center">朵雾</div><div class="author-info__description text-center">奔跑吧，少年</div><div class="follow-button"><a href="https://github.com/wuduo0701" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">13</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">13</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">11</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://storage.360buyimg.com/app-oss-dev/2021/8/22f1f0ca10954b30b5b0c1cfeb4e7222.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">朵雾のBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about">About</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">微信小程序：仿小米商城</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E6%9C%AF/">技术</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E6%9C%AF/javascript/">javascript</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%8A%80%E6%9C%AF/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">4.8k</span><span class="post-meta__separator">|</span><span>Reading time: 23 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>微信小程序作为一款耳熟能详的应用，相信大家或多或少都已经有过这方面的接触了。作为一名刚接触前端不久的小白，手写一款小程序是很好的对知识的一次巩固。下面让我们来开始小程序的开发吧。</p>
<h2 id="开发准备"><a href="#开发准备" class="headerlink" title="开发准备"></a>开发准备</h2><ul>
<li>开发工具:<a href="https://code.visualstudio.com/Download" target="_blank" rel="noopener">VSCode</a>          <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html?t=201714" target="_blank" rel="noopener">微信开发者工具</a></li>
<li><a href="https://www.iconfont.cn/" target="_blank" rel="noopener">图标icon</a></li>
<li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/" target="_blank" rel="noopener">微信开发文档</a></li>
<li><a href="https://youzan.github.io/vant-weapp" target="_blank" rel="noopener">有赞组件库</a></li>
<li><a href="https://github.com/1970186643/lesson_shuidi/blob/master/mini_program/MIshop/utils/data.js" target="_blank" rel="noopener">自己Mock的数据</a><h2 id="项目目录结构"><a href="#项目目录结构" class="headerlink" title="项目目录结构"></a>项目目录结构</h2><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704c775205b1e1a?w=407&h=780&f=png&s=45355" alt="alt"><h1 id="页面解构"><a href="#页面解构" class="headerlink" title="页面解构"></a>页面解构</h1><h2 id="商城首页"><a href="#商城首页" class="headerlink" title="商城首页"></a>商城首页</h2><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704ca337a7c73b3?w=360&h=642&f=gif&s=20735531" alt="alt"><h3 id="页面解析"><a href="#页面解析" class="headerlink" title="页面解析"></a>页面解析</h3><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704cde4ab97c595?w=535&h=668&f=png&s=207788" alt="alt"></li>
<li>Navigation是小程序的顶部导航组件。原生的Navigation组件并不满足的我们的需求，我们需要在其中加一个搜索框，这就需要我们对其进行自定义了。好了话不多说，撸起袖子就是干。<h4 id="Navigation"><a href="#Navigation" class="headerlink" title="Navigation"></a>Navigation</h4><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704caa27a4fe369?w=375&h=67&f=png&s=6490" alt="alt"><br>我们先要对你需要修改的页面json文件进行配置</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;navigationStyle&quot;: &quot;custom&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了写出来的Navigation能适配所有手机，我们也需要对app.js进行修改。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  onLaunch: function () &#123;</span><br><span class="line">    &#x2F;&#x2F; 获取顶部栏信息</span><br><span class="line">    wx.getSystemInfo(&#123;</span><br><span class="line">      success: res &#x3D;&gt; &#123;</span><br><span class="line">        &#x2F;&#x2F;导航高度</span><br><span class="line">        this.globalData.navHeight &#x3D; res.statusBarHeight + 46;</span><br><span class="line">      &#125;, fail(err) &#123;</span><br><span class="line">        console.log(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  globalData: &#123;</span><br><span class="line">    userInfo: null,</span><br><span class="line">    navHeight: 0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>微信官方提供了查询状态栏的高度的<a href="https://developers.weixin.qq.com/miniprogram/dev/api/base/system/system-info/wx.getSystemInfo.html" target="_blank" rel="noopener">API</a>(wx.getSystemInfo)，大家也可以自己看看。</p>
<p>然后就是我们自定义导航栏的时候啦。直接上代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;view&gt;</span><br><span class="line">  &lt;view class&#x3D;&#39;nav bg-white&#39; style&#x3D;&#39;height:&#123;&#123;navH&#125;&#125;px&#39;&gt;</span><br><span class="line">    &lt;view class&#x3D;&#39;nav-title&#39;&gt;</span><br><span class="line">      &lt;view class&#x3D;&quot;INinputheader&quot;&gt;</span><br><span class="line">				&lt;image src&#x3D;&quot;..&#x2F;..&#x2F;images&#x2F;icon&#x2F;mi.png&quot; mode&#x3D;&quot;widthFix&quot; class&#x3D;&quot;image&quot;&#x2F;&gt;</span><br><span class="line">				&lt;text&gt;小米&lt;&#x2F;text&gt;</span><br><span class="line">        &lt;icon class&#x3D;&quot;INsearchicon&quot; type&#x3D;&quot;search&quot; size&#x3D;&quot;12&quot;&#x2F;&gt;</span><br><span class="line">        &lt;navigator url&#x3D;&quot;..&#x2F;search&#x2F;search&quot;&gt;</span><br><span class="line">            &lt;input class&#x3D;&quot;weui-input&quot; placeholder&#x3D;&quot;搜索商品&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;navigator&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">  &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>

<p>由于自定义导航栏的代码过于累赘，我们在此就不贴出来了。大家可以点击<a href="https://github.com/1970186643/lesson_shuidi/blob/master/mini_program/MIshop/pages/home/home.wxss" target="_blank" rel="noopener">这里</a><br>查看哦。其实还是觉得自定义的导航栏有点丑，但想要模仿的一模一样真的挺困难的。<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704cd1a2b6ce0c1?w=255&h=255&f=jpeg&s=10432" alt="alt"></p>
<ul>
<li>首页的轮播图区域，微信官方文档提供了<a href="https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html" target="_blank" rel="noopener">swiper组件</a>，直接用就好了。所以多看文档真的是一种有效的学习手段。</li>
<li>首页的频道分类页面分别由不同的页面构成，点击相应的icon进行跳转</li>
</ul>
<p>我的思路是在js文件下每个icon下写对应的跳转后的url，这样使用wx:for就能跳转到各自相应的页面了，下面是部分代码。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;container1&quot;&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;flex-box&quot; &gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;list-item&quot; wx:for&#x3D;&quot;&#123;&#123;img_icon_Urls1&#125;&#125;&quot; wx:for-item&#x3D;&quot;icon1&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">            &lt;navigator url&#x3D;&quot;&#123;&#123;icon1.url&#125;&#125;&quot;&gt;</span><br><span class="line">                &lt;image src&#x3D;&quot;&#123;&#123;icon1.icon_img&#125;&#125;&quot; class&#x3D;&quot;icon-size&quot;&#x2F;&gt;</span><br><span class="line">            &lt;&#x2F;navigator&gt;</span><br><span class="line">        &lt;&#x2F;view&gt; </span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;flex-box&quot; &gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;list-item&quot; wx:for&#x3D;&quot;&#123;&#123;img_icon_Urls1&#125;&#125;&quot; wx:for-item&#x3D;&quot;icon1&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">            &lt;text class&#x3D;&quot;text-center&quot;&gt;&#123;&#123;icon1.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">        &lt;&#x2F;view&gt; </span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;flex-box&quot; &gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;list-item&quot; wx:for&#x3D;&quot;&#123;&#123;img_icon_Urls2&#125;&#125;&quot; wx:for-item&#x3D;&quot;icon2&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">            &lt;image src&#x3D;&quot;&#123;&#123;icon2.icon_img&#125;&#125;&quot; class&#x3D;&quot;icon-size&quot;&#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;view&gt; </span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;flex-box&quot; &gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;list-item&quot; wx:for&#x3D;&quot;&#123;&#123;img_icon_Urls2&#125;&#125;&quot; wx:for-item&#x3D;&quot;icon2&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">            &lt;text class&#x3D;&quot;text-center&quot;&gt;&#123;&#123;icon2.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">        &lt;&#x2F;view&gt; </span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>这里数据我们都是放在一个js文件中的，在全局app.js进行了引用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import data from &quot;.&#x2F;utils&#x2F;data&quot;;</span><br><span class="line">App(&#123;</span><br><span class="line">  onLaunch: function () &#123;</span><br><span class="line">    Object.assign(this.globalData,data);</span><br><span class="line">    &#125;,</span><br><span class="line">    globalData: &#123;</span><br><span class="line">    userInfo: null,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这样我们在每个页面就可以引用数据的时候都需要声明以下代码，这样我们就可以在app.js文件中拿到自己需要的数据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const app &#x3D; getApp();</span><br></pre></td></tr></table></figure>

<p>下面是商城首页的js文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const showDetail&#x3D;(e)&#x3D;&gt;&#123;</span><br><span class="line">  const id &#x3D; e.currentTarget.dataset.pid;</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">      url: &#96;&#x2F;pages&#x2F;commodity&#x2F;commodity?id&#x3D;$&#123;id&#125;&#96;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line">const app &#x3D; getApp();</span><br><span class="line">Page(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    img_title_Urls:[],</span><br><span class="line">    img_icon_Urls1:[],</span><br><span class="line">    img_icon_Urls2:[],</span><br><span class="line">    recommand:[],</span><br><span class="line">    love:[],</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad()&#123;</span><br><span class="line">    const img_title_Urls &#x3D; app.globalData.img_title_Urls,</span><br><span class="line">          img_icon_Urls1 &#x3D; app.globalData.img_icon_Urls1,</span><br><span class="line">          img_icon_Urls2 &#x3D; app.globalData.img_icon_Urls2,</span><br><span class="line">          recommand &#x3D; app.globalData.recommand,</span><br><span class="line">          love &#x3D; app.globalData.love;         </span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      img_title_Urls,</span><br><span class="line">      img_icon_Urls1,</span><br><span class="line">      img_icon_Urls2,</span><br><span class="line">      recommand,</span><br><span class="line">      love,</span><br><span class="line">      navH: app.globalData.navHeight</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  showDetail,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><ul>
<li>首页搜索功能<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704cfe4a49e4187?w=360&h=644&f=gif&s=7145730" alt="alt"></li>
</ul>
<p>页面解析：这里我们引用了有赞的组件的搜索框，如果搜索的内容匹配到了数据，我们就在其下方显示出来。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;van-search placeholder&#x3D;&quot;搜索商品&quot; value&#x3D;&quot;&#123;&#123; value &#125;&#125;&quot; background&#x3D;&quot;#FFFFFF&quot;  bind:search&#x3D;&quot;Search&quot;&#x2F;&gt;</span><br><span class="line">&lt;view class&#x3D;&quot;box&quot; wx:for&#x3D;&quot;&#123;&#123;good_list&#125;&#125;&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">  &lt;view data-pid&#x3D;&quot;&#123;&#123;item.id&#125;&#125;&quot; bindtap&#x3D;&quot;showDetail&quot;&gt;</span><br><span class="line">    &lt;text &gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;line&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">  &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>

<p>思路分析：</p>
<ul>
<li>输入需要查询的关键字或者准确的内容，进行模糊查询。</li>
<li>查询后就在下方显示出查询到的内容。</li>
<li>点击内容会跳到相应商品的详细信息。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var search &#x3D; (list,keyword) &#x3D;&gt;&#123; &#x2F;&#x2F;模糊查询函数</span><br><span class="line">  var arr &#x3D; [];</span><br><span class="line">  for(let i &#x3D; 0;i &lt; list.length;i++)</span><br><span class="line">  &#123;</span><br><span class="line">    if(list[i].split(keyword).length &gt; 1)&#123;</span><br><span class="line">      arr.push(list[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return arr;</span><br><span class="line">&#125;;</span><br><span class="line">const showDetail&#x3D;(e)&#x3D;&gt;&#123;</span><br><span class="line">  const id &#x3D; e.currentTarget.dataset.pid;</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">      url: &#96;&#x2F;pages&#x2F;commodity&#x2F;commodity?id&#x3D;$&#123;id&#125;&#96;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line">const app &#x3D; getApp();</span><br><span class="line">Page(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    commodity:[],   &#x2F;&#x2F;总商品列表</span><br><span class="line">    name:[],</span><br><span class="line">    good_list:[],   &#x2F;&#x2F;搜索后的商品列表</span><br><span class="line">    classify:[</span><br><span class="line">      &#123;</span><br><span class="line">        name:&quot;手机&quot;,</span><br><span class="line">        url:&quot;..&#x2F;navi&#x2F;phone&#x2F;phone&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  Search(event)&#123;</span><br><span class="line">    const name &#x3D; this.data.name;</span><br><span class="line">    const commodity &#x3D; this.data.commodity;</span><br><span class="line">    const keyword &#x3D; event.detail;</span><br><span class="line">    &#x2F;&#x2F; wx.setStorageSync(&#39;history&#39;,keyword); &#x2F;&#x2F;设置搜索历史</span><br><span class="line">    var arr &#x3D; [];</span><br><span class="line">    arr &#x3D; search(name,keyword);</span><br><span class="line">    var product &#x3D; [];</span><br><span class="line">    for(let i &#x3D; 0;i &lt; commodity.length;i++)&#123;</span><br><span class="line">      for(let j &#x3D; 0;j &lt; arr.length ;j++)&#123;</span><br><span class="line">        if(commodity[i].name &#x3D;&#x3D; arr[j])&#123;</span><br><span class="line">          product.push(commodity[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      good_list:product</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad:function()&#123;</span><br><span class="line">    const commodity &#x3D; app.globalData.commodity_detial.filter(item&#x3D;&gt;&#123;</span><br><span class="line">      return true;</span><br><span class="line">    &#125;);</span><br><span class="line">    var name &#x3D; [];</span><br><span class="line">    for(let i &#x3D; 0;i&lt;commodity.length;i++)&#123;</span><br><span class="line">      name.push(commodity[i].name)</span><br><span class="line">    &#125;</span><br><span class="line">    this.setData(&#123;</span><br><span class="line">      name,</span><br><span class="line">      commodity</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  showDetail,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="商品分类页面"><a href="#商品分类页面" class="headerlink" title="商品分类页面"></a>商品分类页面</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d3dfea7a7bf2?w=360&h=642&f=gif&s=8582272" alt="alt"></p>
<h3 id="页面解析-1"><a href="#页面解析-1" class="headerlink" title="页面解析"></a>页面解析</h3><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d1c85d8b1079?w=377&h=670&f=png&s=56422" alt="alt"></p>
<p>思路分析：</p>
<ul>
<li>页面由两个scroll-view构成，左边为商品的菜单栏，右边为对应菜单的商品区。点击左边的菜单栏项目会跳到相应的商品区。这里由scroll-view里的参数scroll-into-view可以实现，值得注意的是此时设的id不能为数字，否则会报错。有不懂的童鞋，可以点击<a href="https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html" target="_blank" rel="noopener">这里</a>参考官方文档。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;main&quot;&gt;</span><br><span class="line">    &lt;scroll-view  scroll-y&#x3D;&quot;&#123;&#123;true&#125;&#125;&quot; class&#x3D;&quot;nav&quot; scroll-left&#x3D;&quot;&#123;&#123;navScrollLeft&#125;&#125;&quot; scroll-with-animation&#x3D;&quot;&#123;&#123;true&#125;&#125;&quot; &gt;</span><br><span class="line">        &lt;block wx:for&#x3D;&quot;&#123;&#123;navData&#125;&#125;&quot; wx:for-index&#x3D;&quot;id&quot; wx:for-item&#x3D;&quot;navItem&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">            &lt;view class&#x3D;&quot;nav-item &#123;&#123;currentTab &#x3D;&#x3D; id?&#39;active&#39;:&#39;&#39;&#125;&#125;&quot;  data-current&#x3D;&quot;&#123;&#123;id&#125;&#125;&quot; data-id&#x3D;&quot;&#123;&#123;navItem.id&#125;&#125;&quot;  bindtap&#x3D;&quot;scrollToView&quot;&gt;&#123;&#123;navItem.name&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;block&gt;</span><br><span class="line">    &lt;&#x2F;scroll-view&gt;</span><br><span class="line">    &lt;scroll-view scroll-y&#x3D;&quot;&#123;&#123;true&#125;&#125;&quot; scroll-with-animation&#x3D;&quot;&#123;&#123;true&#125;&#125;&quot; scroll-into-view&#x3D;&quot;&#123;&#123;toView&#125;&#125;&quot; enable-back-to-top scroll-top&#x3D;&quot;&#123;&#123;scrollTop&#125;&#125;&quot; class&#x3D;&quot;nav1&quot;&gt;</span><br><span class="line">        &lt;view  wx:for&#x3D;&quot;&#123;&#123;item&#125;&#125;&quot; wx:for-item&#x3D;&quot;item&quot; wx:key&#x3D;&quot;index&quot; &gt;</span><br><span class="line">            &lt;view id&#x3D;&quot;&#123;&#123;item.id&#125;&#125;&quot; &gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;flex-box&quot;&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;linebox&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;line1&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;text class&#x3D;&quot;title&quot;&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;view class&#x3D;&quot;linebox&quot;&gt;</span><br><span class="line">                        &lt;view class&#x3D;&quot;line2&quot;&gt;&lt;&#x2F;view&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;flex-box&quot; &gt;</span><br><span class="line">                    &lt;view  wx:for&#x3D;&quot;&#123;&#123;item.cate_list&#125;&#125;&quot; wx:for-item&#x3D;&quot;cate&quot; wx:key&#x3D;&quot;&#123;&#123;item.id&#125;&#125;&quot;&gt;</span><br><span class="line">                        &lt;image src&#x3D;&quot;&#123;&#123;cate.img&#125;&#125;&quot; class&#x3D;&quot;img-size list-item&quot; mode&#x3D;&quot;widthFix&quot; data-cid&#x3D;&quot;&#123;&#123;cate.id&#125;&#125;&quot; bindtap&#x3D;&quot;showcDetail&quot;&#x2F;&gt;</span><br><span class="line">                        &lt;text class&#x3D;&quot;font&quot;&gt;&#123;&#123;cate.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">                    &lt;&#x2F;view&gt; </span><br><span class="line">                &lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;view&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;scroll-view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>

<p>这里是跳转到相应商品区的代码。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scrollToView(e)&#123;   </span><br><span class="line">  const cur &#x3D; e.currentTarget.dataset.current; </span><br><span class="line">  const id &#x3D; e.currentTarget.dataset.id;</span><br><span class="line">  this.setData(&#123;</span><br><span class="line">    toView: id,</span><br><span class="line">    currentTab: cur,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li>点击右边的商品区域会跳转到对应商品的详细信息页面。因为我们这里的商品详情页都是统一做的，跳转的时候我们会传递商品的id过去,在详情页我们会对其匹配相应的id，这样商品的详细信息就可以对应的输出来了。下面为跳转到商品详情页代码。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const showcDetail&#x3D;(e)&#x3D;&gt;&#123;</span><br><span class="line">  const id &#x3D; e.currentTarget.dataset.cid;</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">      url: &#96;&#x2F;pages&#x2F;commodity&#x2F;commodity?id&#x3D;$&#123;id&#125;&#96;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="商品详情页面"><a href="#商品详情页面" class="headerlink" title="商品详情页面"></a>商品详情页面</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d8e4a7545ae4?w=360&h=644&f=gif&s=5143449" alt="alt"></p>
<h3 id="页面解析-2"><a href="#页面解析-2" class="headerlink" title="页面解析"></a>页面解析</h3><ul>
<li>这里为所有商品的统一界面，跳转时我们会把相应商品的数据传输到这个页面，这样显示的就是为不同的商品界面。</li>
<li>由于原生的weui有些太丑了，就引用了有赞的<a href="https://youzan.github.io/vant-weapp/#/tab" target="_blank" rel="noopener">tabs</a>和<a href="https://youzan.github.io/vant-weapp/#/goods-action" target="_blank" rel="noopener">GoodsAction</a>组件。有兴趣的童鞋可以点击查看。</li>
</ul>
<p>这里贴代码的时候mackdown编辑出了问题，所以只贴了tabs标签和下方的加入购物车部分。完整的代码可以点<a href="https://github.com/1970186643/lesson_shuidi/blob/master/mini_program/MIshop/pages/commodity/commodity.wxml" target="_blank" rel="noopener">这里</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;view&gt;</span><br><span class="line">  &lt;van-tabs active&#x3D;&quot;&#123;&#123;active&#125;&#125;&quot;  title-active-color&#x3D;&quot;#ff4a00&quot; title-inactive-color&#x3D;&quot;#c0c0c0c&quot; duration&#x3D;&quot;0.1&quot; 	&gt;</span><br><span class="line">    &lt;van-tab title&#x3D;&quot;商品详情&quot;&gt;</span><br><span class="line">      &lt;view wx:for&#x3D;&quot;&#123;&#123;commodity.overview&#125;&#125;&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">        &lt;image src&#x3D;&quot;&#123;&#123;item&#125;&#125;&quot; mode&#x3D;&quot;widthFix&quot; class&#x3D;&quot;i1&quot;&#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;van-tab&gt;</span><br><span class="line">    &lt;van-tab title&#x3D;&quot;规格参数&quot;&gt;</span><br><span class="line">      &lt;view wx:for&#x3D;&quot;&#123;&#123;commodity.parameter&#125;&#125;&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">        &lt;image src&#x3D;&quot;&#123;&#123;item&#125;&#125;&quot; mode&#x3D;&quot;widthFix&quot; class&#x3D;&quot;i1&quot;&#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;van-tab&gt;</span><br><span class="line">  &lt;&#x2F;van-tabs&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br><span class="line">&lt;van-goods-action&gt;</span><br><span class="line">  &lt;van-goods-action-icon icon&#x3D;&quot;cart-o&quot; text&#x3D;&quot;购物车&quot; bind:click&#x3D;&quot;go_sh_cart&quot;&#x2F;&gt;</span><br><span class="line">  &lt;van-goods-action-button type&#x3D;&quot;warning&quot;color&#x3D;&quot;#ff4a00&quot; text&#x3D;&quot;加入购物车&quot;  bind:click&#x3D;&quot;go_select&quot;&#x2F;&gt;</span><br><span class="line">  &lt;van-goods-action-button type&#x3D;&quot;danger&quot; text&#x3D;&quot;立即购买&quot;  &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;van-goods-action&gt;</span><br></pre></td></tr></table></figure>

<h2 id="商品类别选择"><a href="#商品类别选择" class="headerlink" title="商品类别选择"></a>商品类别选择</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704da72fd155227?w=360&h=642&f=gif&s=1834257" alt="alt"></p>
<h3 id="页面解析-3"><a href="#页面解析-3" class="headerlink" title="页面解析"></a>页面解析</h3><ul>
<li>商品跳转后,会取得对应商品的数据。点击不同的商品类别，对应的值会进行改变。代码有点过长，这里只贴了部分，有兴趣的童鞋可以点击<a href="https://github.com/1970186643/lesson_shuidi/tree/master/mini_program/MIshop/pages/select_commodity" target="_blank" rel="noopener">这里</a>查看完整的。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">onLoad: function (options) &#123;</span><br><span class="line">  const id &#x3D; options.id;</span><br><span class="line">  const commodity &#x3D; app.globalData.commodity_detial.filter(item&#x3D;&gt;&#123;</span><br><span class="line">    return item.id &#x3D;&#x3D; id;</span><br><span class="line">  &#125;);</span><br><span class="line">  this.setData(&#123;</span><br><span class="line">    id:commodity[0].id,</span><br><span class="line">    commodity:commodity[0],</span><br><span class="line">    name:commodity[0].name,</span><br><span class="line">    version:commodity[0].select_list.version[0].name,</span><br><span class="line">    price:commodity[0].select_list.version[0].price,</span><br><span class="line">    color:commodity[0].select_list.color[0].name,</span><br><span class="line">    img_url:commodity[0].select_list.color[0].img  </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<ul>
<li>这里同样用了有赞的步进器<a href="https://youzan.github.io/vant-weapp/#/stepper" target="_blank" rel="noopener">stepper</a>组件</li>
</ul>
<p>wxml</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;van-stepper value&#x3D;&quot;&#123;&#123; 1 &#125;&#125;&quot; max&#x3D;&quot;5&quot; integer&#x3D;&quot;true&quot; bind:change&#x3D;&quot;onChange&quot; button-size&#x3D;&quot;40&quot; input-width&#x3D;&quot;40&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<p>js(这里可以取得步进器中的值)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">onChange(event) &#123;</span><br><span class="line">  const number &#x3D; event.detail;</span><br><span class="line">  &#x2F;&#x2F; console.log(number)</span><br><span class="line">  this.setData(&#123;</span><br><span class="line">    num:number</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>点击确定按钮后，加入到购物车当中，且不会影响到前面所添加的商品。这里确实卡了好久，脑壳疼。这里有个小坑，在使用wx.showToast要使用一个延时函数，否则调用成功提示会一闪而过。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">  submit()&#123;</span><br><span class="line">    const that &#x3D; this;</span><br><span class="line">    wx.setStorageSync(&#39;id&#39;,that.data.id);</span><br><span class="line">    wx.setStorageSync(&#39;name&#39;,that.data.name);</span><br><span class="line">    wx.setStorageSync(&#39;img_url&#39;,that.data.img_url);</span><br><span class="line">    wx.setStorageSync(&#39;version&#39;,that.data.version);</span><br><span class="line">    wx.setStorageSync(&#39;price&#39;,that.data.price);</span><br><span class="line">    wx.setStorageSync(&#39;color&#39;,that.data.color);</span><br><span class="line">    wx.setStorageSync(&#39;num&#39;,that.data.num);</span><br><span class="line">    wx.setStorageSync(&#39;selected&#39;,that.data.selected);</span><br><span class="line">    const value &#x3D; wx.getStorageSync(&#39;cart_list&#39;);</span><br><span class="line">    const temp &#x3D; &#123;</span><br><span class="line">      &#39;id&#39;:wx.getStorageSync(&#39;id&#39;),</span><br><span class="line">      &#39;name&#39;: wx.getStorageSync(&#39;name&#39;),</span><br><span class="line">      &#39;img_url&#39;: wx.getStorageSync(&#39;img_url&#39;),</span><br><span class="line">      &#39;version&#39;: wx.getStorageSync(&#39;version&#39;),</span><br><span class="line">      &#39;price&#39;: wx.getStorageSync(&#39;price&#39;),</span><br><span class="line">      &#39;color&#39;: wx.getStorageSync(&#39;color&#39;),</span><br><span class="line">      &#39;num&#39;: wx.getStorageSync(&#39;num&#39;),</span><br><span class="line">      &#39;selected&#39;: wx.getStorageSync(&#39;selected&#39;),</span><br><span class="line">    &#125;</span><br><span class="line">    if(value &#x3D;&#x3D; &quot;&quot;)&#123;</span><br><span class="line">      wx.setStorageSync(&#39;cart_list&#39;, [temp]);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      wx.setStorageSync(&#39;cart_list&#39;, [temp, ...value]);</span><br><span class="line">    &#125;</span><br><span class="line">&#x2F;&#x2F;使用wx.showToast时要使用一个延时(setTimeout)，否则成功调用后会一闪而过</span><br><span class="line">    wx.showToast(&#123;</span><br><span class="line">      title: &quot;成功加入购物车&quot;,</span><br><span class="line">      icon: &#39;success&#39;,</span><br><span class="line">      duration: 2000,</span><br><span class="line">      success()&#123;  </span><br><span class="line">        setTimeout(function()&#123;</span><br><span class="line">          wx.navigateBack(&#123;</span><br><span class="line">            delta: 1</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="地址选择和新增地址页"><a href="#地址选择和新增地址页" class="headerlink" title="地址选择和新增地址页"></a>地址选择和新增地址页</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704dcdbc3c81235?w=360&h=640&f=gif&s=1585934" alt="alt"></p>
<h3 id="页面解析-4"><a href="#页面解析-4" class="headerlink" title="页面解析"></a>页面解析</h3><ul>
<li>这里新增的地址都是通过wx.getStorageSync的API保存在本地，以便后续的添加，当然有数据库操作更加方便。<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704dd3bc79473b2?w=800&h=736&f=png&s=138560" alt="alt"></li>
</ul>
<h2 id="发现页"><a href="#发现页" class="headerlink" title="发现页"></a>发现页</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d45b8975706a?w=360&h=644&f=gif&s=1759814" alt="alt"><br>这里没写太多，只是简单的切了下页面，发现抽奖功能没后台不好做。<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d4a710d1d2d7?w=320&h=240&f=jpeg&s=28923" alt="alt"></p>
<h2 id="购物车页面"><a href="#购物车页面" class="headerlink" title="购物车页面"></a>购物车页面</h2><h3 id="页面解析-5"><a href="#页面解析-5" class="headerlink" title="页面解析"></a>页面解析</h3><p>首先判断购物车cart_list的值是否存在，这里用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wx:if&#x3D;&quot;&#123;&#123;cart_list &#x3D;&#x3D; &#39;&#39;&#125;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>作为判断条件。</p>
<ul>
<li>购物车为空时，显示购物车还是空的，到小米商城逛逛。点击按钮会跳转到商城首页。<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d4dab7eff38c?w=377&h=669&f=png&s=17405" alt="alt"></li>
<li>购物车不为空时，可以对商品进行选择，计算总价，计算总数，滑动删除等操作。<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704d7e4ea329d03?w=360&h=646&f=gif&s=14062871" alt="alt"></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;view class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">  &lt;view wx:if&#x3D;&quot;&#123;&#123;cart_list &#x3D;&#x3D; &#39;&#39;&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;empty&quot;&gt;</span><br><span class="line">      &lt;view class&#x3D;&quot;cart_icon&quot;&gt;</span><br><span class="line">        &lt;image src&#x3D;&quot;..&#x2F;..&#x2F;images&#x2F;icon&#x2F;cart_empty.png&quot; mode&#x3D;&quot;aspectFill&quot; &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">      &lt;view class&#x3D;&quot;prompt&quot;&gt;购物车还是空的&lt;&#x2F;view&gt;</span><br><span class="line">      &lt;button type&#x3D;&quot;warn&quot; size&#x3D;&quot;default&quot; class&#x3D;&quot;button&quot; style&#x3D;&quot;background: #ff6600;&quot; bindtap&#x3D;&quot;go&quot;&gt;</span><br><span class="line">        &lt;text &gt;到小米商城逛逛&lt;&#x2F;text&gt;</span><br><span class="line">      &lt;&#x2F;button&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">  &lt;&#x2F;view&gt;</span><br><span class="line">  &lt;view wx:else class&#x3D;&quot;mt&quot;&gt;</span><br><span class="line">    &lt;view wx:for&#x3D;&quot;&#123;&#123;cart_list&#125;&#125;&quot; wx:key&#x3D;&quot;index&quot;&gt;</span><br><span class="line">	&lt;view class&#x3D;&quot;weui-slidecells&quot;&gt;</span><br><span class="line">            &lt;mp-slideview buttons&#x3D;&quot;&#123;&#123;slideButtons&#125;&#125;&quot; bindbuttontap&#x3D;&quot;slideButtonTap&quot; data-index&#x3D;&quot;&#123;&#123;index&#125;&#125;&quot;&gt;</span><br><span class="line">                &lt;view class&#x3D;&quot;weui-slidecell&quot;&gt;</span><br><span class="line">		    &lt;view class&#x3D;&quot;box&quot;&gt;</span><br><span class="line">			&lt;view class&#x3D;&quot;icon&quot;&gt;</span><br><span class="line">			    &lt;icon wx:if&#x3D;&quot;&#123;&#123;item.selected&#125;&#125;&quot; type&#x3D;&quot;success&quot; color&#x3D;&quot;rgb(255,103,0)&quot; bindtap&#x3D;&quot;selectList&quot; data-index&#x3D;&quot;&#123;&#123;index&#125;&#125;&quot; size&#x3D;&quot;20&quot; class&#x3D;&quot;i&quot;&#x2F;&gt;</span><br><span class="line">			    &lt;icon wx:else type&#x3D;&quot;circle&quot; bindtap&#x3D;&quot;selectList&quot; data-index&#x3D;&quot;&#123;&#123;index&#125;&#125;&quot; size&#x3D;&quot;20&quot; color&#x3D;&quot;rgb(255,103,0)&quot; class&#x3D;&quot;i&quot;&#x2F;&gt;</span><br><span class="line">			&lt;&#x2F;view&gt;</span><br><span class="line">			&lt;view class&#x3D;&quot;navi&quot;&gt;</span><br><span class="line">			    &lt;navigator url&#x3D;&quot;..&#x2F;commodity&#x2F;commodity?id&#x3D;&#123;&#123;item.id&#125;&#125;&quot;&gt;</span><br><span class="line">				&lt;image  src&#x3D;&quot;&#123;&#123;item.img_url&#125;&#125;&quot;&gt;&lt;&#x2F;image&gt;</span><br><span class="line">			    &lt;&#x2F;navigator&gt;</span><br><span class="line">			&lt;&#x2F;view&gt;</span><br><span class="line">			&lt;text class&#x3D;&quot;title&quot;&gt;&#123;&#123;item.name&#125;&#125; &#123;&#123;item.version&#125;&#125; &#123;&#123;item.color&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">			&lt;text class&#x3D;&quot;num&quot;&gt;&#123;&#123;item.num&#125;&#125; X&lt;&#x2F;text&gt;</span><br><span class="line">			&lt;text class&#x3D;&quot;price&quot;&gt;　&#123;&#123;item.price&#125;&#125;元&lt;&#x2F;text&gt;</span><br><span class="line">		    &lt;&#x2F;view&gt;</span><br><span class="line">         	&lt;&#x2F;view&gt;</span><br><span class="line">            &lt;&#x2F;mp-slideview&gt;</span><br><span class="line">        &lt;&#x2F;view&gt;				</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;view class&#x3D;&quot;submit_title&quot;&gt;</span><br><span class="line">	&lt;view class&#x3D;&quot;icon&quot;&gt;</span><br><span class="line">	    &lt;icon wx:if&#x3D;&quot;&#123;&#123;selectedAll&#125;&#125;&quot; type&#x3D;&quot;success&quot; size&#x3D;&quot;20&quot; color&#x3D;&quot;rgb(255,103,0)&quot; bindtap&#x3D;&quot;selectAll&quot; class&#x3D;&quot;i1&quot;&#x2F;&gt;</span><br><span class="line">	    &lt;icon wx:else type&#x3D;&quot;circle&quot; size&#x3D;&quot;20&quot; color&#x3D;&quot;rgb(255,103,0)&quot; bindtap&#x3D;&quot;selectAll&quot; class&#x3D;&quot;i1&quot;&#x2F;&gt;</span><br><span class="line">	&lt;&#x2F;view&gt;</span><br><span class="line">	&lt;text class&#x3D;&quot;all&quot;&gt;全选&lt;&#x2F;text&gt;</span><br><span class="line">	    &lt;view class&#x3D;&quot;allprice&quot;&gt;</span><br><span class="line">    	        &lt;text &gt;合计:&lt;&#x2F;text&gt;</span><br><span class="line">    	        &lt;text class&#x3D;&quot;totalprice&quot;&gt;　&#123;&#123;totalPrice&#125;&#125;元&lt;&#x2F;text&gt;</span><br><span class="line">	    &lt;&#x2F;view&gt;</span><br><span class="line">	    &lt;view class&#x3D;&quot;submit&quot;&gt;结算(&#123;&#123;totalNum&#125;&#125;)&lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">&lt;&#x2F;view&gt;  </span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure>
<h3 id="功能-1"><a href="#功能-1" class="headerlink" title="功能"></a>功能</h3><ul>
<li>判断商品是否选中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">selectList(e)&#123;</span><br><span class="line">  const index &#x3D; e.currentTarget.dataset.index;</span><br><span class="line">  let cart_list &#x3D; this.data.cart_list;</span><br><span class="line">  const selected &#x3D; cart_list[index].selected;</span><br><span class="line">  cart_list[index].selected &#x3D; !selected;</span><br><span class="line">  const symbol &#x3D; cart_list.some(cart &#x3D;&gt; &#123;</span><br><span class="line">    return cart.selected &#x3D;&#x3D;&#x3D; false;</span><br><span class="line">  &#125;);</span><br><span class="line">  if (symbol) &#123;</span><br><span class="line">    this.data.selectedAll &#x3D; false;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    this.data.selectedAll &#x3D; true;</span><br><span class="line">  &#125;</span><br><span class="line">  this.setData(&#123;</span><br><span class="line">    cart_list,</span><br><span class="line">    selectedAll: this.data.selectedAll</span><br><span class="line">  &#125;);</span><br><span class="line">  this.getTotalPrice();   &#x2F;&#x2F;状态改变，重新计算总价</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>计算商品总价和总数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getTotalPrice()&#123;</span><br><span class="line">  let cart_list &#x3D; this.data.cart_list;                </span><br><span class="line">  let total &#x3D; 0,</span><br><span class="line">      num &#x3D; 0;</span><br><span class="line">  for(let i &#x3D; 0; i&lt;cart_list.length; i++) &#123;         </span><br><span class="line">      if(cart_list[i].selected) &#123;                   &#x2F;&#x2F; 判断选中才会计算价格</span><br><span class="line">          total &#x3D; total + cart_list[i].num * cart_list[i].price;</span><br><span class="line">          num &#x3D; num + parseInt(cart_list[i].num);     </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  this.setData(&#123;                                </span><br><span class="line">    cart_list: cart_list,</span><br><span class="line">    totalPrice: total,</span><br><span class="line">    totalNum: num</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>判断商品是否全选</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">selectAll(e)&#123;</span><br><span class="line">  let selectedAll &#x3D; this.data.selectedAll;   </span><br><span class="line">  selectedAll &#x3D; !selectedAll;</span><br><span class="line">  let cart_list &#x3D; this.data.cart_list;</span><br><span class="line">  for (let i &#x3D; 0; i &lt; cart_list.length; i++) &#123;</span><br><span class="line">    cart_list[i].selected &#x3D; selectedAll;            &#x2F;&#x2F; 改变所有商品状态</span><br><span class="line">  &#125;</span><br><span class="line">  this.setData(&#123;</span><br><span class="line">      selectedAll: selectedAll,</span><br><span class="line">      cart_list: cart_list</span><br><span class="line">  &#125;);</span><br><span class="line">  this.getTotalPrice();                               &#x2F;&#x2F; 重新获取总价</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除商品<br><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704dc4b03231471?w=360&h=638&f=gif&s=543965" alt="alt"></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">slideButtonTap(e)&#123;</span><br><span class="line">  const index&#x3D;e.currentTarget.dataset.index;</span><br><span class="line">  console.log(index);</span><br><span class="line">  this.data.cart_list.splice(index, 1);</span><br><span class="line">  wx.clearStorageSync(&quot;num&quot;);</span><br><span class="line">  this.setData(&#123;</span><br><span class="line">    cart_list: this.data.cart_list</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们使用的是左滑删除，微信官方文档提供了Slideview组件，可以点击<a href="https://developers.weixin.qq.com/miniprogram/dev/extended/weui/slideview.html" target="_blank" rel="noopener">这里</a>查看。</p>
<h2 id="我的页面"><a href="#我的页面" class="headerlink" title="我的页面"></a>我的页面</h2><p><img src="https://user-gold-cdn.xitu.io/2020/2/16/1704dc53b94aff6f?w=378&h=669&f=png&s=34924" alt="alt"></p>
<h3 id="页面解析-6"><a href="#页面解析-6" class="headerlink" title="页面解析"></a>页面解析</h3><p>这里我们只做简单的页面，头像和名字都是通过open-data来获取的微信头像和名字。这里大部分都是需要后台来做的，就没有过多的花费时间了。</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>在写这个项目的时候碰到了许多的难题，每天都是在写bug和debug中度过。程序员的一天真的好真实，但是这也让我学习了很多，写代码一定要亲手尝试，这样才能更快的提升自己的能力。由于小米商城这个项目是在太大了，只做了部分主要功能。希望能给予他人一点帮助，如果文章中有错误或不妥之处，欢迎大家指正。这里是项目的<a href="https://github.com/1970186643/lesson_shuidi/tree/master/mini_program/MIshop" target="_blank" rel="noopener">地址</a>，如果觉得还不错的话，就star一下吧。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">朵雾</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/posts/miShop.html">http://yoursite.com/posts/miShop.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/javascript/">javascript</a><a class="post-meta__tags" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">微信小程序</a></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-615423d4337aeb70" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/posts/cache.html"><i class="fa fa-chevron-left">  </i><span>能不能说下前端缓存？</span></a></div><div class="next-post pull-right"><a href="/posts/vue-vdom.html"><span>Vue之虚拟DOM(vdom)</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitment-container"></div><script>var gitment = new Gitment({
  id: md5(decodeURI(location.pathname)),
  owner: 'wuduo0701',
  repo: 'git-comment',
  oauth: {
    client_id: '82bc937662704b9b11a2',
    client_secret: '733bedef042206f854e4ac9c128d57962ea504f2'
  }
})
gitment.render('gitment-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://storage.360buyimg.com/app-oss-dev/2021/8/22f1f0ca10954b30b5b0c1cfeb4e7222.png)"><div class="layout" id="footer"><div class="copyright">&copy;2021 By 朵雾</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/algolia.js"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>